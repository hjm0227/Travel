<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카카오맵</title>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=0ddbe6e883bed9490fd3749f409c3383"></script>
    <style>
        #map {
            width: 1000px;
            height: 1000px;
            margin: 0 auto;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
<h1>카카오맵</h1>
<div id="map"></div>

<script>
    // 지도 초기화
    var container = document.getElementById('map');
    var options = {
        center: new kakao.maps.LatLng(33.4628, 126.3285), // 지도 중심 좌표
        level: 10 // 지도 확대 레벨
    };

    var map = new kakao.maps.Map(container, options);

    // 제주공항 좌표
    const jejuAirport = { lat: 33.5113, lng: 126.4982 };

    // 두 좌표 사이 거리 계산 (단위: km)
    function calculateDistance(lat1, lng1, lat2, lng2) {
        const R = 6371; // 지구의 반지름 (단위: km)
        const toRad = angle => (angle * Math.PI) / 180; // 각도를 라디안으로 변환

        const dLat = toRad(lat2 - lat1);
        const dLng = toRad(lng2 - lng1);

        const a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLng / 2) * Math.sin(dLng / 2);

        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c; // 거리 (km)
    }

    // 서버에서 장소 데이터 가져오기
    fetch('/travel/locations') // 엔드포인트 호출
        .then(response => response.json())
        .then(locations => {
            locations.forEach(location => {
                // 마커 생성
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(location.latitude, location.longitude),
                    title: location.name
                });

                // 거리 계산
                const distance = calculateDistance(
                    jejuAirport.lat,
                    jejuAirport.lng,
                    location.latitude,
                    location.longitude
                ).toFixed(2); // 소수점 둘째 자리까지

                // 인포윈도우 추가
                var infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">
                                <strong>${location.name}</strong><br>
                                제주공항에서 ${distance}km
                              </div>`
                });

                // 마커에 마우스 이벤트 추가
                kakao.maps.event.addListener(marker, 'mouseover', function () {
                    infowindow.open(map, marker);
                });

                kakao.maps.event.addListener(marker, 'mouseout', function () {
                    infowindow.close();
                });
            });
        })
        .catch(error => console.error('데이터 로드 오류:', error));
</script>
</body>
</html>
